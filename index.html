<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XinyÃ¬ & Yutingçš„å†°å²›8å¤©7å¤œè¯¦ç»†è¡Œç¨‹åœ°å›¾ | 2026å¹´2æœˆ19-26æ—¥</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .container {
            display: flex;
            height: calc(100vh - 100px);
        }

        #map {
            flex: 1;
            height: 100%;
            position: relative;
        }

        .sidebar {
            width: 400px;
            background: white;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
        }

        .day-section {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }

        .day-section:hover {
            background: #f8f9fa;
        }

        .day-section.active {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
        }

        .day-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .day-title-left {
            display: flex;
            align-items: center;
        }

        .day-badge {
            display: inline-block;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            text-align: center;
            line-height: 32px;
            margin-right: 10px;
            font-size: 14px;
            font-weight: bold;
        }

        .day-info {
            font-size: 13px;
            color: #666;
            margin-left: 42px;
            margin-bottom: 8px;
        }

        .day-stats {
            display: flex;
            gap: 15px;
            margin-left: 42px;
            margin-top: 8px;
            font-size: 12px;
            color: #888;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .intensity-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .intensity-easy {
            background: #d4edda;
            color: #155724;
        }

        .intensity-moderate {
            background: #fff3cd;
            color: #856404;
        }

        .intensity-hard {
            background: #f8d7da;
            color: #721c24;
        }

        /* åœ°å›¾ä¸Šçš„ä¿¡æ¯é¢æ¿ */
        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-width: 380px;
            max-height: 70vh;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .info-panel.active {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-panel-header {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .info-panel-content {
            font-size: 13px;
            color: #666;
            line-height: 1.6;
        }

        .info-panel-section {
            margin-bottom: 12px;
        }

        .info-panel-section-title {
            font-weight: bold;
            color: #444;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .info-panel-list {
            list-style: none;
            padding: 0;
        }

        .info-panel-list li {
            padding: 4px 0;
            padding-left: 18px;
            position: relative;
        }

        .info-panel-list li:before {
            content: "\2022";
            position: absolute;
            left: 5px;
            color: #667eea;
            font-weight: bold;
        }

        .timeline-item {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .timeline-time {
            color: #667eea;
            font-weight: bold;
            min-width: 50px;
        }

        .timeline-content {
            color: #555;
        }

        .legend {
            padding: 15px;
            background: #fff3cd;
            border-top: 2px solid #ffc107;
        }

        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 20px;
            height: 3px;
            margin-right: 10px;
            border-radius: 2px;
        }

        .legend-marker {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
        }

        /* è‡ªå®šä¹‰å¼¹å‡ºçª—å£ */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
            padding: 0;
            min-width: 250px;
        }

        .popup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 14px;
        }

        .popup-body {
            padding: 12px;
            font-size: 12px;
        }

        .popup-body p {
            margin: 6px 0;
            line-height: 1.5;
        }

        .popup-highlight {
            background: #fff3cd;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 11px;
            color: #856404;
        }

        .close-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            z-index: 10;
        }

        .close-panel:hover {
            background: #5568d3;
        }

        /* å¤©æ°”æ ·å¼ */
        .weather-section {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: linear-gradient(135deg, #e0f7fa 0%, #e8eaf6 100%);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .weather-icon {
            font-size: 32px;
            line-height: 1;
        }

        .weather-details {
            flex: 1;
        }

        .weather-desc {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .weather-temp {
            font-size: 13px;
            color: #555;
            margin-top: 2px;
        }

        .weather-extra {
            font-size: 11px;
            color: #888;
            margin-top: 2px;
        }

        .weather-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            font-size: 11px;
            color: #555;
            background: #e8f4fd;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 6px;
        }

        .weather-loading {
            color: #aaa;
            font-size: 12px;
            font-style: italic;
        }

        /* æ€»è§ˆå­é¡µé¢æ ·å¼ */
        .overview-location-header {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .overview-day-card {
            padding: 10px 14px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            border-left: 4px solid #667eea;
            transition: all 0.2s ease;
        }

        .overview-day-card:hover {
            background: #e3f2fd;
            transform: translateX(4px);
        }

        .overview-day-card-title {
            font-weight: bold;
            color: #333;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .overview-day-card-spots {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
        }

        .overview-day-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 6px;
        }

        .view-day-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 12px;
            transition: all 0.3s ease;
        }

        .view-day-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* ç¼–å·æ ‡è®°æ ·å¼ */
        .numbered-marker {
            position: relative;
            cursor: pointer;
        }

        .numbered-marker .marker-circle {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            font-weight: bold;
            color: white;
            transition: transform 0.3s ease;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .numbered-marker:hover .marker-circle {
            transform: scale(1.25);
            box-shadow: 0 4px 16px rgba(0,0,0,0.6);
        }

        .numbered-marker .marker-name {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 2px;
            white-space: nowrap;
            font-size: 11px;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 0 4px rgba(0,0,0,0.9), 0 0 4px rgba(0,0,0,0.9), 0 1px 3px rgba(0,0,0,0.8);
            pointer-events: none;
            letter-spacing: 0.3px;
        }

        /* æ˜Ÿçº§æ ‡è®°ç‰¹æ•ˆ */
        .numbered-marker.star-marker .marker-circle {
            animation: starPulse 2.5s infinite;
        }

        @keyframes starPulse {
            0% { box-shadow: 0 2px 10px rgba(0,0,0,0.5), 0 0 0 0 rgba(255,255,255,0.4); }
            70% { box-shadow: 0 2px 10px rgba(0,0,0,0.5), 0 0 0 10px rgba(255,255,255,0); }
            100% { box-shadow: 0 2px 10px rgba(0,0,0,0.5), 0 0 0 0 rgba(255,255,255,0); }
        }

        /* Leaflet tooltip on dark map */
        .leaflet-tooltip {
            background: rgba(20,20,30,0.9);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 3px 12px rgba(0,0,0,0.4);
        }
        .leaflet-tooltip-top:before {
            border-top-color: rgba(20,20,30,0.9);
        }

        /* è·¯çº¿åŠ¨ç”» */
        @keyframes dash {
            to {
                stroke-dashoffset: -20;
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 280px;
            }

            #map {
                height: calc(100vh - 380px);
            }

            .info-panel {
                left: 10px;
                right: 10px;
                bottom: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ‡®ğŸ‡¸ XinyÃ¬ & Yutingçš„å†°å²›8å¤©7å¤œè¯¦ç»†è¡Œç¨‹åœ°å›¾</h1>
        <p>2026å¹´2æœˆ19æ—¥-26æ—¥ | ä¼¦æ•¦å¾€è¿” | é¢„ç®—Â¥17,000-19,000</p>
    </div>

    <div class="container">
        <div id="map">
            <div id="infoPanel" class="info-panel">
                <button class="close-panel" onclick="closeInfoPanel()">Ã—</button>
                <div id="infoPanelContent"></div>
            </div>
        </div>

        <div class="sidebar">
            <div class="day-section" data-day="0">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">ğŸ“</span>
                        <span>è¡Œç¨‹æ€»è§ˆ</span>
                    </div>
                </div>
                <div class="day-info">ç‚¹å‡»æŸ¥çœ‹å®Œæ•´8å¤©è·¯çº¿å›¾</div>
                <div class="day-stats">
                    <div class="stat-item">ğŸ“ æ€»é‡Œç¨‹ï¼šçº¦1,800å…¬é‡Œ</div>
                </div>
            </div>

            <div class="day-section" data-day="1">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">1</span>
                        <span>2æœˆ19æ—¥ å‘¨å››</span>
                    </div>
                    <span class="intensity-badge intensity-easy">è½»æ¾</span>
                </div>
                <div class="day-info">ğŸ“ ä¼¦æ•¦ â†’ é›·å…‹é›…æœªå…‹ï¼ˆæ·±å¤œ23:55æŠµè¾¾ï¼‰</div>
                <div class="day-stats">
                    <div class="stat-item">âœˆï¸ é£è¡Œ3h20m</div>
                    <div class="stat-item">ğŸšŒ äº¤é€š45åˆ†é’Ÿ</div>
                </div>
            </div>

            <div class="day-section" data-day="2">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">2</span>
                        <span>2æœˆ20æ—¥ å‘¨äº”</span>
                    </div>
                    <span class="intensity-badge intensity-easy">è½»æ¾</span>
                </div>
                <div class="day-info">ğŸ“ é›·å…‹é›…æœªå…‹å¸‚åŒºè§‚å…‰</div>
                <div class="day-stats">
                    <div class="stat-item">â›ª 4ä¸ªæ™¯ç‚¹</div>
                    <div class="stat-item">ğŸ›’ è¶…å¸‚é‡‡è´­</div>
                </div>
            </div>

            <div class="day-section" data-day="3">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">3</span>
                        <span>2æœˆ21æ—¥ å‘¨å…­</span>
                    </div>
                    <span class="intensity-badge intensity-moderate">ä¸­ç­‰</span>
                </div>
                <div class="day-info">ğŸ“ é»„é‡‘åœˆ â†’ å—æµ·å²¸</div>
                <div class="day-stats">
                    <div class="stat-item">ğŸ“ çº¦300km</div>
                    <div class="stat-item">â­ 5å¤§æ™¯ç‚¹</div>
                    <div class="stat-item">ğŸŒŒ æå…‰</div>
                </div>
            </div>

            <div class="day-section" data-day="4">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">4</span>
                        <span>2æœˆ22æ—¥ å‘¨æ—¥</span>
                    </div>
                    <span class="intensity-badge intensity-hard">é«˜å¼ºåº¦</span>
                </div>
                <div class="day-info">ğŸ“ å—æµ·å²¸ â†’ å†°å·å¾’æ­¥</div>
                <div class="day-stats">
                    <div class="stat-item">ğŸ“ çº¦200km</div>
                    <div class="stat-item">ğŸ§Š å†°å·3å°æ—¶</div>
                    <div class="stat-item">ğŸŒŒ æå…‰</div>
                </div>
            </div>

            <div class="day-section" data-day="5">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">5</span>
                        <span>2æœˆ23æ—¥ å‘¨ä¸€</span>
                    </div>
                    <span class="intensity-badge intensity-hard">é«˜å¼ºåº¦</span>
                </div>
                <div class="day-info">ğŸ“ å†°æ²³æ¹– â†’ é›·å…‹é›…æœªå…‹</div>
                <div class="day-stats">
                    <div class="stat-item">ğŸ“ çº¦450km</div>
                    <div class="stat-item">â„ï¸ å†°æ´3å°æ—¶</div>
                    <div class="stat-item">â° 20:00è¿”å›</div>
                </div>
            </div>

            <div class="day-section" data-day="6">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">6</span>
                        <span>2æœˆ24æ—¥ å‘¨äºŒ</span>
                    </div>
                    <span class="intensity-badge intensity-moderate">ä¸­ç­‰</span>
                </div>
                <div class="day-info">ğŸ“ æ–¯å¥ˆå±±åŠå²›ç¯æ¸¸</div>
                <div class="day-stats">
                    <div class="stat-item">ğŸ“ çº¦400km</div>
                    <div class="stat-item">â­ 7å¤§æ™¯ç‚¹</div>
                    <div class="stat-item">ğŸ—£ï¸ ä¸­æ–‡å¯¼æ¸¸</div>
                </div>
            </div>

            <div class="day-section" data-day="7">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">7</span>
                        <span>2æœˆ25æ—¥ å‘¨ä¸‰</span>
                    </div>
                    <span class="intensity-badge intensity-hard">é«˜å¼ºåº¦</span>
                </div>
                <div class="day-info">ğŸ“ ç«å±±å¾’æ­¥ + è“æ¹–æ¸©æ³‰</div>
                <div class="day-stats">
                    <div class="stat-item">ğŸ“ çº¦100km</div>
                    <div class="stat-item">ğŸŒ‹ å¾’æ­¥4å°æ—¶</div>
                    <div class="stat-item">â™¨ï¸ æ¸©æ³‰2.5å°æ—¶</div>
                </div>
            </div>

            <div class="day-section" data-day="8">
                <div class="day-title">
                    <div class="day-title-left">
                        <span class="day-badge">8</span>
                        <span>2æœˆ26æ—¥ å‘¨å››</span>
                    </div>
                    <span class="intensity-badge intensity-easy">è½»æ¾</span>
                </div>
                <div class="day-info">ğŸ“ é›·å…‹é›…æœªå…‹ â†’ ä¼¦æ•¦ï¼ˆ16:20ç¦»å¢ƒï¼‰</div>
                <div class="day-stats">
                    <div class="stat-item">ğŸ›ï¸ 3å°æ—¶è´­ç‰©</div>
                    <div class="stat-item">âœˆï¸ é£è¡Œ3h10m</div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-title">ğŸ—ºï¸ å›¾ä¾‹è¯´æ˜</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF6B6B; height: 4px;"></div>
                    <span>Day 3: é»„é‡‘åœˆè·¯çº¿</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ECDC4; height: 4px;"></div>
                    <span>Day 4-5: å—æµ·å²¸è·¯çº¿</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #45B7AF; height: 4px;"></div>
                    <span>Day 6: æ–¯å¥ˆå±±åŠå²›</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #F38181; height: 4px;"></div>
                    <span>Day 7: ç«å±±+è“æ¹–</span>
                </div>
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e0e0e0;">
                    <div class="legend-item">
                        <div class="legend-marker" style="background: #FF6B6B; color: white; display: flex; align-items: center; justify-content: center; font-size: 9px; font-weight: bold;">3</div>
                        <span>ç¼–å· = æ‰€å±æ—¥æœŸ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-marker" style="background: #FFD700; color: white; display: flex; align-items: center; justify-content: center; font-size: 9px;">â˜…</div>
                        <span>â˜… = æ ¸å¿ƒæ™¯ç‚¹</span>
                    </div>
                </div>
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e0e0e0; font-size: 11px; color: #666;">
                    ğŸ’¡ ç‚¹å‡»æ ‡è®°æŸ¥çœ‹è¯¦æƒ…ï¼Œç‚¹å‡»è·¯çº¿è·³è½¬æ—¥æœŸ
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // åˆå§‹åŒ–åœ°å›¾ - Esriå«æ˜Ÿåº•å›¾
        const icelandBounds = L.latLngBounds([63.2, -24.8], [65.2, -15.5]);
        const map = L.map('map', {
            center: [64.2, -19.5],
            zoom: 7,
            minZoom: 7,
            maxZoom: 15,
            zoomAnimation: true,
            maxBounds: icelandBounds.pad(0.1),
            maxBoundsViscosity: 0.8
        });

        // å«æ˜Ÿå½±åƒåº•å›¾
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '&copy; Esri, Maxar, Earthstar Geographics',
            maxZoom: 18
        }).addTo(map);

        // åœ°åæ ‡ç­¾è¦†ç›–å±‚
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 18,
            opacity: 0.7
        }).addTo(map);

        // å®šä¹‰æ‰€æœ‰ä½ç½®
        const locations = {
            reykjavik: [64.1466, -21.9426],
            keflavik_airport: [63.9850, -22.6056],
            thingvellir: [64.2558, -21.1292],
            bruarfoss: [64.2639, -20.5167],
            geysir: [64.3107, -20.3014],
            gullfoss: [64.3271, -20.1211],
            seljalandsfoss: [63.6156, -19.9886],
            hotel_dranghlid: [63.5333, -19.5167],
            skogafoss: [63.5319, -19.5114],
            falljokull: [64.0167, -16.4167],
            hrifunes: [63.8333, -18.0833],
            jokulsarlon: [64.0784, -16.2306],
            diamond_beach: [64.0428, -16.1803],
            ice_cave: [63.95, -16.9],
            reynisfjara: [63.4028, -19.0456],
            ytri_tunga: [64.8611, -23.5000],
            budir: [64.8194, -23.7889],
            arnarstapi: [64.7583, -23.6167],
            djupalonssandur: [64.7458, -23.9361],
            londrangar: [64.7333, -23.7833],
            kirkjufell: [64.9439, -23.3125],
            fagradalsfjall: [63.8833, -22.2667],
            blue_lagoon: [63.8804, -22.4495]
        };

        // åœ°ç‚¹åˆ°æ—¥æœŸçš„æ˜ å°„
        const locationDayMap = {
            reykjavik: { name: 'é›·å…‹é›…æœªå…‹', days: [1, 2, 5, 6, 7, 8], type: 'hotel' },
            keflavik_airport: { name: 'å‡¯å¤«æ‹‰ç»´å…‹æœºåœº', days: [1, 8], type: 'attraction' },
            thingvellir: { name: 'è¾›æ ¼éŸ¦å¾·åˆ©å›½å®¶å…¬å›­', days: [3], type: 'attraction' },
            bruarfoss: { name: 'å¸ƒé²é˜¿å°”ç€‘å¸ƒ', days: [3], type: 'attraction' },
            geysir: { name: 'é—´æ­‡æ³‰åŒº', days: [3], type: 'attraction' },
            gullfoss: { name: 'é»„é‡‘ç€‘å¸ƒ', days: [3], type: 'star' },
            seljalandsfoss: { name: 'å¡é‡Œé›…å…°ç€‘å¸ƒ', days: [3], type: 'star' },
            hotel_dranghlid: { name: 'Hotel Dranghlid', days: [3, 4], type: 'hotel' },
            skogafoss: { name: 'æ–¯ç§‘åŠ ç€‘å¸ƒ', days: [4], type: 'attraction' },
            falljokull: { name: 'Falljokullå†°å·', days: [4], type: 'star' },
            hrifunes: { name: 'Hrifunesæ—…é¦†', days: [4, 5], type: 'hotel' },
            jokulsarlon: { name: 'æ°å¤æ²™é¾™å†°æ²³æ¹–', days: [5], type: 'star' },
            diamond_beach: { name: 'é’»çŸ³æµ·æ»©', days: [5], type: 'attraction' },
            ice_cave: { name: 'è“å†°æ´', days: [5], type: 'star' },
            reynisfjara: { name: 'é›·å°¼æ–¯é»‘æ²™æ»©', days: [5], type: 'attraction' },
            ytri_tunga: { name: 'Ytri-Tungaæµ·æ»©', days: [6], type: 'attraction' },
            budir: { name: 'Budiré»‘æ•™å ‚', days: [6], type: 'attraction' },
            arnarstapi: { name: 'Arnarstapiæ¸”æ‘', days: [6], type: 'attraction' },
            djupalonssandur: { name: 'Djupalonssandur', days: [6], type: 'attraction' },
            londrangar: { name: 'Londrangarå²©æŸ±', days: [6], type: 'attraction' },
            kirkjufell: { name: 'æ•™ä¼šå±±', days: [6], type: 'star' },
            fagradalsfjall: { name: 'ç«å±±å¾’æ­¥', days: [7], type: 'star' },
            blue_lagoon: { name: 'è“æ¹–æ¸©æ³‰', days: [7], type: 'star' }
        };

        // è¡Œç¨‹æ—¥æœŸæ˜ å°„ï¼ˆç”¨äºå¤©æ°”APIï¼‰
        const tripDates = {
            1: '2026-02-19', 2: '2026-02-20', 3: '2026-02-21', 4: '2026-02-22',
            5: '2026-02-23', 6: '2026-02-24', 7: '2026-02-25', 8: '2026-02-26'
        };

        // WMOå¤©æ°”ä»£ç æ˜ å°„
        const weatherCodeMap = {
            0: { desc: 'æ™´å¤©', icon: 'â˜€ï¸' },
            1: { desc: 'å¤§éƒ¨åˆ†æ™´', icon: 'ğŸŒ¤ï¸' },
            2: { desc: 'å¤šäº‘', icon: 'â›…' },
            3: { desc: 'é˜´å¤©', icon: 'â˜ï¸' },
            45: { desc: 'æœ‰é›¾', icon: 'ğŸŒ«ï¸' },
            48: { desc: 'é›¾å‡‡', icon: 'ğŸŒ«ï¸' },
            51: { desc: 'å°æ¯›é›¨', icon: 'ğŸŒ¦ï¸' },
            53: { desc: 'ä¸­æ¯›é›¨', icon: 'ğŸŒ¦ï¸' },
            55: { desc: 'å¤§æ¯›é›¨', icon: 'ğŸŒ§ï¸' },
            56: { desc: 'å†»æ¯›é›¨', icon: 'ğŸŒ§ï¸' },
            57: { desc: 'é‡å†»æ¯›é›¨', icon: 'ğŸŒ§ï¸' },
            61: { desc: 'å°é›¨', icon: 'ğŸŒ§ï¸' },
            63: { desc: 'ä¸­é›¨', icon: 'ğŸŒ§ï¸' },
            65: { desc: 'å¤§é›¨', icon: 'ğŸŒ§ï¸' },
            66: { desc: 'å†»é›¨', icon: 'ğŸŒ§ï¸' },
            67: { desc: 'é‡å†»é›¨', icon: 'ğŸŒ§ï¸' },
            71: { desc: 'å°é›ª', icon: 'ğŸŒ¨ï¸' },
            73: { desc: 'ä¸­é›ª', icon: 'ğŸŒ¨ï¸' },
            75: { desc: 'å¤§é›ª', icon: 'â„ï¸' },
            77: { desc: 'é›ªç²’', icon: 'ğŸŒ¨ï¸' },
            80: { desc: 'é˜µé›¨', icon: 'ğŸŒ§ï¸' },
            81: { desc: 'ä¸­é˜µé›¨', icon: 'ğŸŒ§ï¸' },
            82: { desc: 'æš´é›¨', icon: 'ğŸŒ§ï¸' },
            85: { desc: 'å°é˜µé›ª', icon: 'ğŸŒ¨ï¸' },
            86: { desc: 'å¤§é˜µé›ª', icon: 'â„ï¸' },
            95: { desc: 'é›·æš´', icon: 'â›ˆï¸' },
            96: { desc: 'é›·æš´+å†°é›¹', icon: 'â›ˆï¸' },
            99: { desc: 'é›·æš´+å¤§å†°é›¹', icon: 'â›ˆï¸' }
        };

        // æ¯æ—¥é¢œè‰²æ–¹æ¡ˆï¼ˆDay 1-8å„ä¸€è‰²ï¼‰
        const dayColors = {
            1: '#667eea', // ç´«è“ - æŠµè¾¾
            2: '#667eea', // ç´«è“ - å¸‚åŒº
            3: '#FF6B6B', // çº¢è‰² - é»„é‡‘åœˆ
            4: '#4ECDC4', // é’è‰² - å—æµ·å²¸
            5: '#4ECDC4', // é’è‰² - å†°æ²³æ¹–
            6: '#45B7AF', // æ·±é’ - æ–¯å¥ˆå±±
            7: '#F38181', // ç²‰çº¢ - ç«å±±è“æ¹–
            8: '#667eea'  // ç´«è“ - ç¦»å¢ƒ
        };

        // æ€»è§ˆè·¯çº¿å¯¹åº”æ—¥æœŸ
        const routeDayMap = [
            { day: 3, label: 'Day 3: é»„é‡‘åœˆ', color: '#FF6B6B' },
            { day: 4, label: 'Day 4-5: å—æµ·å²¸', color: '#4ECDC4' },
            { day: 6, label: 'Day 6: æ–¯å¥ˆå±±åŠå²›', color: '#45B7AF' },
            { day: 7, label: 'Day 7: ç«å±±+è“æ¹–', color: '#F38181' }
        ];

        // åˆ›å»ºç¼–å·å›¾æ ‡ï¼ˆæ€»è§ˆç”¨ï¼‰
        function createNumberedIcon(dayNum, label, type, showLabel) {
            const color = dayColors[dayNum] || '#667eea';
            const isStar = type === 'star';
            const size = isStar ? 32 : 28;
            const fontSize = isStar ? 13 : 12;
            const starClass = isStar ? 'star-marker' : '';
            const displayText = isStar ? 'â˜…' : dayNum;
            const nameHTML = showLabel ? `<div class="marker-name">${label}</div>` : '';

            return L.divIcon({
                className: `numbered-marker ${starClass}`,
                html: `<div class="marker-circle" style="background:${color};width:${size}px;height:${size}px;font-size:${fontSize}px;">${displayText}</div>${nameHTML}`,
                iconSize: [size, size + (showLabel ? 16 : 0)],
                iconAnchor: [size / 2, size / 2]
            });
        }

        // æ¯æ—¥è§†å›¾ç”¨çš„å›¾æ ‡ï¼ˆå¸¦æ—¥æœŸç¼–å·ï¼‰
        function createDayIcon(dayNum, type) {
            const color = dayColors[dayNum] || '#667eea';
            const isStar = type === 'star';
            const isHotel = type === 'hotel';
            const size = isStar ? 32 : isHotel ? 30 : 26;
            const fontSize = isStar ? 13 : 12;
            const starClass = isStar ? 'star-marker' : '';
            const displayText = isStar ? 'â˜…' : isHotel ? 'ğŸ¨' : dayNum;

            return L.divIcon({
                className: `numbered-marker ${starClass}`,
                html: `<div class="marker-circle" style="background:${color};width:${size}px;height:${size}px;font-size:${fontSize}px;">${displayText}</div>`,
                iconSize: [size, size],
                iconAnchor: [size / 2, size / 2]
            });
        }

        // å…¼å®¹æ—§ä»£ç çš„å›¾æ ‡å¼•ç”¨
        const hotelIcon = createDayIcon(3, 'hotel');
        const attractionIcon = createDayIcon(3, 'attraction');
        const starIcon = createDayIcon(3, 'star');

        // åˆ›å»ºå›¾å±‚ç»„
        let currentLayers = L.layerGroup().addTo(map);
        let currentDay = null;

        // ==================== å¤©æ°”ç³»ç»Ÿ ====================
        let weatherCache = null;
        let weatherFetchTime = null;

        async function fetchWeather() {
            if (weatherCache && weatherFetchTime && (Date.now() - weatherFetchTime < 30 * 60 * 1000)) {
                return weatherCache;
            }
            try {
                const resp = await fetch(
                    'https://api.open-meteo.com/v1/forecast?latitude=64.1466&longitude=-21.9426' +
                    '&daily=temperature_2m_max,temperature_2m_min,weathercode,windspeed_10m_max,precipitation_sum' +
                    '&timezone=Atlantic/Reykjavik&start_date=2026-02-19&end_date=2026-02-26'
                );
                if (!resp.ok) throw new Error('Weather API error');
                const data = await resp.json();
                weatherCache = data;
                weatherFetchTime = Date.now();
                return data;
            } catch (e) {
                console.warn('å¤©æ°”æ•°æ®è·å–å¤±è´¥:', e);
                return null;
            }
        }

        function getWeatherForDay(weatherData, dayNum) {
            if (!weatherData || !weatherData.daily) return null;
            const dateStr = tripDates[dayNum];
            if (!dateStr) return null;
            const idx = weatherData.daily.time.indexOf(dateStr);
            if (idx === -1) return null;
            const code = weatherData.daily.weathercode[idx];
            const info = weatherCodeMap[code] || { desc: 'æœªçŸ¥', icon: 'â“' };
            return {
                icon: info.icon,
                desc: info.desc,
                tempMax: Math.round(weatherData.daily.temperature_2m_max[idx]),
                tempMin: Math.round(weatherData.daily.temperature_2m_min[idx]),
                wind: Math.round(weatherData.daily.windspeed_10m_max[idx]),
                precip: weatherData.daily.precipitation_sum[idx]
            };
        }

        function buildWeatherHTML(weather) {
            if (!weather) return '<div class="weather-loading">å¤©æ°”é¢„æŠ¥å°†åœ¨å‡ºå‘å‰ä¸¤å‘¨æ›´æ–°</div>';
            return `<div class="weather-section">
                <div class="weather-icon">${weather.icon}</div>
                <div class="weather-details">
                    <div class="weather-desc">${weather.desc}</div>
                    <div class="weather-temp">${weather.tempMin}Â°C ~ ${weather.tempMax}Â°C</div>
                    <div class="weather-extra">é£é€Ÿ ${weather.wind}km/h | é™æ°´ ${weather.precip}mm</div>
                </div>
            </div>`;
        }

        async function updateSidebarWeather() {
            const data = await fetchWeather();
            if (!data || !data.daily) return;
            for (let day = 1; day <= 8; day++) {
                const w = getWeatherForDay(data, day);
                if (!w) continue;
                const section = document.querySelector(`[data-day="${day}"] .day-stats`);
                if (section && !section.querySelector('.weather-badge')) {
                    const badge = document.createElement('div');
                    badge.className = 'stat-item';
                    badge.innerHTML = `<span class="weather-badge">${w.icon} ${w.tempMin}~${w.tempMax}Â°C</span>`;
                    section.appendChild(badge);
                }
            }
        }

        // ==================== è¯¦ç»†è¡Œç¨‹ä¿¡æ¯ ====================
        const dayDetails = {
            1: {
                title: "Day 1: æ·±å¤œæŠµè¾¾",
                date: "2æœˆ19æ—¥ å‘¨å››",
                description: "ä»ä¼¦æ•¦é£å¾€é›·å…‹é›…æœªå…‹ï¼Œæ·±å¤œæŠµè¾¾åå…¥ä½é…’åº—ä¼‘æ¯",
                schedule: [
                    {time: "20:35", activity: "ä¼¦æ•¦å¸Œæ€ç½—T2èµ·é£ï¼ˆFI455ï¼‰"},
                    {time: "23:55", activity: "æŠµè¾¾å‡¯å¤«æ‹‰ç»´å…‹æœºåœº"},
                    {time: "00:30", activity: "å…¥å¢ƒã€æå–è¡Œæ"},
                    {time: "01:00", activity: "ä¹˜Flybusæˆ–å‡ºç§Ÿè½¦å‰å¾€å¸‚åŒº"},
                    {time: "02:00", activity: "åŠç†é…’åº—å…¥ä½"},
                    {time: "02:30", activity: "ä¼‘æ¯ç¡è§‰"}
                ],
                highlights: [
                    "å»ºè®®æ‰“å‡ºç§Ÿè½¦ï¼ˆÂ¥990ï¼‰ï¼Œæ·±å¤œæ›´å®‰å…¨å¿«æ·",
                    "æå‰å‘ŠçŸ¥é…’åº—æ·±å¤œ02:00å…¥ä½",
                    "Flybusè½¦ç¨‹45åˆ†é’Ÿï¼Œå‡ºç§Ÿè½¦35åˆ†é’Ÿ"
                ],
                tips: [
                    "é£æœºä¸Šå°½é‡ç¡è§‰",
                    "å‡†å¤‡å°‘é‡ç°é‡‘ä»¥é˜²ä¸‡ä¸€",
                    "ä¸‹è½½é…’åº—åœ°å€ç¦»çº¿åœ°å›¾"
                ]
            },
            2: {
                title: "Day 2: å¸‚åŒºè§‚å…‰ä¼‘æ•´",
                date: "2æœˆ20æ—¥ å‘¨äº”",
                description: "é›·å…‹é›…æœªå…‹å¸‚åŒºè§‚å…‰ï¼Œè°ƒæ•´æ—¶å·®ï¼Œä¸ºæ¥ä¸‹æ¥çš„è¡Œç¨‹åšå‡†å¤‡",
                schedule: [
                    {time: "09:00", activity: "å“ˆå°”æ ¼æ—å§†æ•™å ‚ï¼ˆç™»å¡”Â¥55ï¼‰"},
                    {time: "10:30", activity: "Laugavegurè´­ç‰©è¡—é—²é€›"},
                    {time: "12:30", activity: "åˆé¤ï¼ˆæ¨èçƒ­ç‹—æ‘ŠÂ¥30ï¼‰"},
                    {time: "14:00", activity: "è€æ¸¯å£+HarpaéŸ³ä¹å…"},
                    {time: "16:00", activity: "Bonusè¶…å¸‚å¤§é‡‡è´­"},
                    {time: "18:00", activity: "æ™šé¤"},
                    {time: "21:00", activity: "æ—©ç¡ï¼ˆæ˜å¤©8ç‚¹å‡ºå‘ï¼‰"}
                ],
                highlights: [
                    "æ•™å ‚ç™»å¡”ä¿¯ç°å…¨åŸå½©è‰²å±‹é¡¶",
                    "Bonusè¶…å¸‚ä¹°æ¥ä¸‹æ¥3å¤©çš„é›¶é£Ÿæ°´",
                    "å……è¶³ä¼‘æ¯ä¸º3æ—¥å›¢åšå‡†å¤‡"
                ],
                tips: [
                    "è´­ç‰©æ¸…å•ï¼šæ°´ã€é¢åŒ…ã€ç«è…¿ã€å¥¶é…ªã€èƒ½é‡æ£’",
                    "å……å¥½æ‰€æœ‰ç”µå­è®¾å¤‡",
                    "æ•´ç†æ˜å¤©éœ€è¦çš„è£…å¤‡"
                ]
            },
            3: {
                title: "Day 3: é»„é‡‘åœˆç»å…¸è·¯çº¿",
                date: "2æœˆ21æ—¥ å‘¨å…­",
                description: "å†°å²›æœ€ç»å…¸çš„é»„é‡‘åœˆè·¯çº¿ï¼ŒåŒ…å«5å¤§å¿…çœ‹æ™¯ç‚¹ï¼Œæ™šä¸Šä½å—æµ·å²¸è¿½æå…‰",
                schedule: [
                    {time: "08:00", activity: "é…’åº—æ¥é€å‡ºå‘"},
                    {time: "09:30", activity: "è¾›æ ¼éŸ¦å¾·åˆ©å›½å®¶å…¬å›­ï¼ˆ1å°æ—¶ï¼‰"},
                    {time: "11:00", activity: "å¸ƒé²é˜¿å°”ç€‘å¸ƒï¼ˆ30åˆ†é’Ÿï¼‰"},
                    {time: "12:00", activity: "é—´æ­‡æ³‰åŒºï¼ˆ45åˆ†é’Ÿï¼‰"},
                    {time: "13:00", activity: "é»„é‡‘ç€‘å¸ƒï¼ˆ45åˆ†é’Ÿï¼‰"},
                    {time: "15:30", activity: "å¡é‡Œé›…å…°ç€‘å¸ƒï¼ˆ45åˆ†é’Ÿï¼‰"},
                    {time: "å‚æ™š", activity: "å…¥ä½å—æµ·å²¸é…’åº—"},
                    {time: "æ™šä¸Š", activity: "è¿½æå…‰ï¼ˆç¬¬ä¸€æ™šæœºä¼šï¼‰"}
                ],
                highlights: [
                    "è¾›æ ¼éŸ¦å¾·åˆ©ï¼šä¸¤å¤§æ¿å—äº¤ç•Œå¤„ï¼Œä¸–ç•Œé—äº§",
                    "é—´æ­‡æ³‰ï¼šæ¯5-10åˆ†é’Ÿå–·å‘ä¸€æ¬¡ï¼Œé«˜è¾¾35ç±³",
                    "é»„é‡‘ç€‘å¸ƒï¼šåŒå±‚ç€‘å¸ƒï¼Œå¯è§å½©è™¹",
                    "å¡é‡Œé›…å…°ï¼šå¯èµ°åˆ°ç€‘å¸ƒåé¢ï¼ˆä¼šæ¹¿èº«ï¼‰",
                    "å¤œæ™šè¿½æå…‰ï¼šè¿œç¦»å…‰æ±¡æŸ“çš„ä¹¡æ‘é…’åº—"
                ],
                tips: [
                    "å¡é‡Œé›…å…°ç€‘å¸ƒå¿…å¤‡é˜²æ°´é›¨è¡£",
                    "è‡ªå¤‡åˆé¤æˆ–é€”ä¸­è´­ä¹°",
                    "ç›¸æœºå¸¦ä¸‰è„šæ¶ï¼ˆæ‹æå…‰ï¼‰",
                    "ä¿æŒç”µé‡å……è¶³"
                ],
                distance: "çº¦300å…¬é‡Œ",
                accommodation: "Hotel DrangshlÃ­Ã°ï¼ˆå—æµ·å²¸ï¼‰",
                meals: "å«æ—©é¤ï¼Œåˆæ™šé¤è‡ªç†"
            },
            4: {
                title: "Day 4: å†°å·å¾’æ­¥æ¢é™©",
                date: "2æœˆ22æ—¥ å‘¨æ—¥",
                description: "ä»Šå¤©çš„é‡å¤´æˆæ˜¯åœ¨FalljÃ¶kullå†°å·ä¸Šå¾’æ­¥2-3å°æ—¶ï¼Œé«˜å¼ºåº¦æ´»åŠ¨",
                schedule: [
                    {time: "07:00", activity: "é…’åº—æ—©é¤ï¼ˆåƒé¥±ï¼ï¼‰"},
                    {time: "08:30", activity: "æ–¯ç§‘åŠ ç€‘å¸ƒï¼ˆ45åˆ†é’Ÿï¼‰"},
                    {time: "10:00", activity: "â­å†°å·å¾’æ­¥å‡†å¤‡ï¼ˆç©¿è£…å¤‡ï¼‰"},
                    {time: "10:30", activity: "â­å†°å·å¾’æ­¥ï¼ˆ2-3å°æ—¶ï¼‰"},
                    {time: "13:30", activity: "åˆé¤ä¼‘æ¯"},
                    {time: "ä¸‹åˆ", activity: "å‰å¾€ä¸œéƒ¨é…’åº—"},
                    {time: "æ™šä¸Š", activity: "è¿½æå…‰ï¼ˆç¬¬äºŒæ™šæœºä¼šï¼‰"}
                ],
                highlights: [
                    "æ–¯ç§‘åŠ ç€‘å¸ƒï¼š60ç±³é«˜ï¼Œå¯çˆ¬430çº§å°é˜¶åˆ°é¡¶",
                    "â­å†°å·å¾’æ­¥ï¼šç©¿å†°çˆªåœ¨å†°å·ä¸Šè¡Œèµ°",
                    "æ¢ç´¢å†°ç¼ã€å†°æ´ï¼Œæ¬£èµè“å†°ä¸–ç•Œ",
                    "ä¸“ä¸šå¯¼æ¸¸è®²è§£å†°å·çŸ¥è¯†",
                    "æ‰€æœ‰è£…å¤‡æä¾›ï¼šå†°çˆªã€å¤´ç›”ã€å†°é•"
                ],
                tips: [
                    "â—å¿…é¡»ç©¿é˜²æ°´å¾’æ­¥é‹ï¼ˆæœ‰è„šè¸æ”¯æ’‘ï¼‰",
                    "ç©¿å¤šå±‚è¡£æœï¼Œä¾¿äºå¢å‡",
                    "å¸¦æ‰‹å¥—ä¿æŠ¤åŒæ‰‹",
                    "æˆ´å¢¨é•œé˜²æ­¢é›ªç›²",
                    "å¬ä»å¯¼æ¸¸æŒ‡æŒ¥ï¼Œæ³¨æ„å®‰å…¨"
                ],
                distance: "çº¦200å…¬é‡Œ",
                accommodation: "HrÃ­funes Innï¼ˆå—æµ·å²¸ä¸œéƒ¨ï¼‰",
                meals: "å«æ—©é¤ï¼Œåˆæ™šé¤è‡ªç†",
                intensity: "é«˜å¼ºåº¦ï¼ˆå†°å·å¾’æ­¥2-3å°æ—¶ï¼‰"
            },
            5: {
                title: "Day 5: å†°æ²³æ¹–ä¸è“å†°æ´",
                date: "2æœˆ23æ—¥ å‘¨ä¸€",
                description: "ä»Šå¤©åˆ°è¾¾è¡Œç¨‹æœ€è¿œç‚¹-å†°æ²³æ¹–ï¼Œæ¢ç´¢è“å†°æ´ï¼Œä¸‹åˆè¿”å›é›·å…‹é›…æœªå…‹",
                schedule: [
                    {time: "07:00", activity: "é…’åº—æ—©é¤"},
                    {time: "09:00", activity: "æ°å¤æ²™é¾™å†°æ²³æ¹–ï¼ˆ1å°æ—¶ï¼‰"},
                    {time: "10:15", activity: "é’»çŸ³æµ·æ»©ï¼ˆ30åˆ†é’Ÿï¼‰"},
                    {time: "11:00", activity: "â­è“å†°æ´æ¢é™©ï¼ˆ2-3å°æ—¶ï¼‰"},
                    {time: "14:00", activity: "åˆé¤"},
                    {time: "15:30", activity: "é›·å°¼æ–¯é»‘æ²™æ»©ï¼ˆ45åˆ†é’Ÿï¼‰"},
                    {time: "è¿”ç¨‹", activity: "è¿”å›é›·å…‹é›…æœªå…‹"},
                    {time: "20:00", activity: "åˆ°è¾¾å¸‚åŒºé…’åº—"}
                ],
                highlights: [
                    "å†°æ²³æ¹–ï¼šå·¨å¤§å†°å±±æ¼‚æµ®ï¼Œå¯èƒ½çœ‹åˆ°æµ·è±¹",
                    "é’»çŸ³æµ·æ»©ï¼šå†°å—å¦‚é’»çŸ³èˆ¬é—ªè€€åœ¨é»‘æ²™æ»©ä¸Š",
                    "â­è“å†°æ´ï¼šè¿›å…¥å†°å·å†…éƒ¨ï¼Œéœ‡æ’¼è“è‰²å†°å¢™",
                    "é»‘æ²™æ»©ï¼šç„æ­¦å²©æŸ±ï¼Œæµ·ä¸­å²©æŸ±",
                    "Super Jeepå‰å¾€å†°æ´ï¼ˆåˆºæ¿€ä½“éªŒï¼‰"
                ],
                tips: [
                    "â—é»‘æ²™æ»©å±é™©æµ·æµªï¼Œç»ä¸èƒŒå¯¹å¤§æµ·",
                    "å†°æ´å†…æ›´å†·ï¼Œå¤šç©¿è¡£æœ",
                    "ç›¸æœºåšå¥½é˜²æ°´ä¿æŠ¤",
                    "ä»Šå¤©è¿”å›è¾ƒæ™šï¼Œæ™šé¤è‡ªç†"
                ],
                distance: "çº¦450å…¬é‡Œï¼ˆå…¨å¤©æœ€é•¿ï¼‰",
                accommodation: "é›·å…‹é›…æœªå…‹å¸‚åŒºé…’åº—",
                meals: "å«æ—©é¤ï¼Œåˆæ™šé¤è‡ªç†",
                intensity: "é«˜å¼ºåº¦ï¼ˆé•¿é€”+å†°æ´æ¢é™©ï¼‰"
            },
            6: {
                title: "Day 6: æ–¯å¥ˆå±±åŠå²›ç¯æ¸¸",
                date: "2æœˆ24æ—¥ å‘¨äºŒ",
                description: "è¢«ç§°ä¸º'å†°å²›ç¼©å½±'çš„æ–¯å¥ˆå±±åŠå²›ï¼Œä¸­æ–‡å¯¼æ¸¸å…¨ç¨‹è®²è§£ï¼Œè½»æ¾èˆ’é€‚",
                schedule: [
                    {time: "08:00", activity: "é…’åº—æ¥é€ï¼ˆä¸­æ–‡å¯¼æ¸¸ï¼‰"},
                    {time: "10:00", activity: "åšå°”åŠ å†…æ–¯ä¼‘æ¯ç«™"},
                    {time: "11:00", activity: "Ytri-Tungaè§‚æµ·è±¹"},
                    {time: "12:15", activity: "BÃºÃ°iré»‘æ•™å ‚"},
                    {time: "13:00", activity: "Arnarstapiæ¸”æ‘"},
                    {time: "14:00", activity: "åˆé¤ï¼ˆè‡ªè´¹ï¼‰"},
                    {time: "15:15", activity: "DjÃºpalÃ³nssanduré»‘æ²™æ»©"},
                    {time: "16:15", activity: "LÃ³ndrangarç„æ­¦å²©æŸ±"},
                    {time: "17:00", activity: "IngjaldshÃ³llæ•™å ‚"},
                    {time: "17:30", activity: "â­æ•™ä¼šå±±ï¼ˆ1å°æ—¶ï¼‰"},
                    {time: "20:00", activity: "è¿”å›é›·å…‹é›…æœªå…‹"}
                ],
                highlights: [
                    "é‡ç”Ÿæµ·è±¹æ –æ¯åœ°ï¼ˆè¿œè·ç¦»è§‚å¯Ÿï¼‰",
                    "æ ‡å¿—æ€§é»‘æ•™å ‚ï¼ˆç½‘çº¢æ‰“å¡ç‚¹ï¼‰",
                    "å¤©ç„¶çŸ³æ‹±é—¨ä¸æµ·å²¸æ‚¬å´–",
                    "1948å¹´æ²‰èˆ¹é—è¿¹+å¤ä»£ä¸¾é‡çŸ³",
                    "â­æ•™ä¼šå±±ï¼šå†°å²›æœ€ä¸Šé•œåœ°æ ‡ï¼Œã€Šæƒæ¸¸ã€‹å–æ™¯åœ°"
                ],
                tips: [
                    "æµ·è¾¹é£å¤§ï¼Œæ³¨æ„ä¿æš–",
                    "æ•™ä¼šå±±æ˜¯æ‘„å½±é‡ç‚¹ï¼Œå¤šç•™æ—¶é—´",
                    "æœ€ä½³æ‹æ‘„æ—¶é—´ï¼šä¸‹åˆ3-4ç‚¹",
                    "åˆé¤è‡ªè´¹ï¼Œå»ºè®®è‡ªå¤‡æˆ–é€”ä¸­è´­ä¹°",
                    "ä¸­æ–‡å¯¼æ¸¸æ²Ÿé€šæ— éšœç¢"
                ],
                distance: "çº¦400å…¬é‡Œ",
                accommodation: "é›·å…‹é›…æœªå…‹å¸‚åŒºé…’åº—",
                meals: "æ—©æ™šé¤è‡ªç†ï¼Œåˆé¤è‡ªè´¹",
                tour: "Trollä¸­æ–‡å¯¼æ¸¸å›¢ï¼Œ12å°æ—¶"
            },
            7: {
                title: "Day 7: ç«å±±å¾’æ­¥+è“æ¹–æ¸©æ³‰",
                date: "2æœˆ25æ—¥ å‘¨ä¸‰",
                description: "å…ˆå¾’æ­¥ç«å±±ç†”å²©åœ°ï¼ˆé«˜å¼ºåº¦ï¼‰ï¼Œç„¶ååœ¨è“æ¹–æ¸©æ³‰æ”¾æ¾æ¢å¤ï¼Œå®Œç¾ç»„åˆ",
                schedule: [
                    {time: "06:30", activity: "èµ·åºŠï¼Œåƒé¥±æ—©é¤ï¼ˆé‡è¦ï¼ï¼‰"},
                    {time: "08:00", activity: "é…’åº—æ¥é€"},
                    {time: "09:00", activity: "Lake Kleifarvatn"},
                    {time: "10:00", activity: "â­ç«å±±å¾’æ­¥ï¼ˆå¾€è¿”4å°æ—¶ï¼‰"},
                    {time: "14:00", activity: "åˆé¤"},
                    {time: "14:30", activity: "â­è“æ¹–æ¸©æ³‰ï¼ˆ2.5å°æ—¶ï¼‰"},
                    {time: "17:00", activity: "è¿”å›å¸‚åŒº"},
                    {time: "18:00", activity: "åˆ°è¾¾é…’åº—"},
                    {time: "æ™šä¸Š", activity: "â—å¿…é¡»æ‰“åŒ…è¡Œæï¼ˆæ˜å¤©ç¦»å¢ƒï¼‰"}
                ],
                highlights: [
                    "â­æ´»ç«å±±å¾’æ­¥ï¼š2021-2023å¹´å–·å‘é—å€",
                    "å´å²–ç†”å²©åœ°å½¢ï¼Œéœ‡æ’¼åœ°è²Œ",
                    "å¾€è¿”æœ€å¤š4å°æ—¶ï¼Œä½“åŠ›æŒ‘æˆ˜",
                    "â­è“æ¹–æ¸©æ³‰ï¼šåœ°çƒ­çŸ¿ç‰©è´¨æ¸©æ³‰",
                    "å…è´¹ç¡…æ³¥é¢è†œ+é¦–æ¯é¥®å“",
                    "å®Œç¾æ”¾æ¾èˆ’ç¼“å¾’æ­¥ç–²åŠ³"
                ],
                tips: [
                    "â—â—â—ä¸¥æ ¼è£…å¤‡è¦æ±‚ï¼š",
                    "âœ“ é˜²æ°´å†²é”‹è¡£ï¼ˆå¿…é¡»ï¼‰",
                    "âœ“ é˜²æ°´è£¤ï¼ˆâŒç¦ç©¿ç‰›ä»”è£¤ï¼å¤±æ¸©å±é™©ï¼ï¼‰",
                    "âœ“ é˜²æ°´å¾’æ­¥é‹ï¼ˆè„šè¸æ”¯æ’‘ï¼‰",
                    "âœ“ ç™»å±±æ–ï¼ˆå¼ºçƒˆå»ºè®®ç§Ÿï¼‰",
                    "âœ“ æ°´1L+é«˜çƒ­é‡é›¶é£Ÿ",
                    "âœ“ æ³³è¡£ï¼ˆè“æ¹–ç”¨ï¼‰",
                    "ä»Šæ™šå¿…é¡»æ‰“åŒ…è¡Œæï¼"
                ],
                distance: "çº¦100å…¬é‡Œ",
                accommodation: "é›·å…‹é›…æœªå…‹å¸‚åŒºé…’åº—",
                meals: "æ—©æ™šé¤è‡ªç†",
                intensity: "é«˜å¼ºåº¦ï¼ˆå¾’æ­¥4å°æ—¶ï¼‰",
                price: "Â¥1,326ï¼ˆç”¨ä¼˜æƒ ç NY20ï¼‰"
            },
            8: {
                title: "Day 8: è´­ç‰©ç¦»å¢ƒ",
                date: "2æœˆ26æ—¥ å‘¨å››",
                description: "ä¸Šåˆ3å°æ—¶è‡ªç”±æ´»åŠ¨è´­ç‰©ï¼Œä¸‹åˆ16:20é£å›ä¼¦æ•¦",
                schedule: [
                    {time: "08:30", activity: "é…’åº—æ—©é¤"},
                    {time: "09:30", activity: "æœ€åè´­ç‰©ï¼ˆ3å°æ—¶ï¼‰"},
                    {time: "12:30", activity: "è¿”å›é…’åº—ï¼Œæœ€åæ£€æŸ¥"},
                    {time: "13:00", activity: "å‡ºå‘å»æœºåœºï¼ˆFlybus/å‡ºç§Ÿè½¦ï¼‰"},
                    {time: "13:45", activity: "åˆ°è¾¾æœºåœº"},
                    {time: "14:00", activity: "åŠç†ç™»æœºã€æ‰˜è¿"},
                    {time: "14:30", activity: "é€€ç¨ï¼ˆå¦‚æœ‰ï¼‰"},
                    {time: "15:00", activity: "å®‰æ£€"},
                    {time: "15:30", activity: "å…ç¨åº—+å€™æœº"},
                    {time: "16:20", activity: "âœˆï¸ FI454èµ·é£"},
                    {time: "19:30", activity: "æŠµè¾¾ä¼¦æ•¦å¸Œæ€ç½—T2"}
                ],
                highlights: [
                    "Laugavegurä¸»è¡—æœ€åè´­ç‰©",
                    "è¡¥æ¼çš„å†°å²›çºªå¿µå“",
                    "æœºåœºå…ç¨åº—ï¼ˆå·§å…‹åŠ›ã€é…’æ›´ä¾¿å®œï¼‰",
                    "é€€ç¨é¢†é’±ï¼ˆå¦‚è´­ç‰©è¶…ISK 6,000ï¼‰",
                    "å……è£•æ—¶é—´ä¸èµ¶"
                ],
                tips: [
                    "å‰ä¸€æ™šå¿…é¡»æ‰“åŒ…å¥½è¡Œæ",
                    "é€€æˆ¿å‰æ£€æŸ¥æ‰€æœ‰è§’è½ï¼ˆå……ç”µå™¨ï¼ï¼‰",
                    "ä¿ç•™ä¸€äº›ISKä½œçºªå¿µ",
                    "æå‰2.5å°æ—¶åˆ°æœºåœº",
                    "æ‰˜è¿è¡Œææ³¨æ„é™é‡"
                ]
            }
        };

        // ==================== ä¿¡æ¯é¢æ¿ ====================
        async function showInfoPanel(day) {
            const details = dayDetails[day];
            if (!details) return;

            // å…ˆæ˜¾ç¤ºé¢æ¿ï¼ˆå¤©æ°”éƒ¨åˆ†ç”¨å ä½ç¬¦ï¼‰
            renderInfoPanel(details, day, null);
            document.getElementById('infoPanel').classList.add('active');

            // å¼‚æ­¥åŠ è½½å¤©æ°”
            const weatherData = await fetchWeather();
            const weather = getWeatherForDay(weatherData, day);
            renderInfoPanel(details, day, weather);
        }

        function renderInfoPanel(details, day, weather) {
            let weatherHTML = weather !== undefined ? buildWeatherHTML(weather) : '';

            let scheduleHTML = details.schedule.map(item =>
                `<div class="timeline-item">
                    <div class="timeline-time">${item.time}</div>
                    <div class="timeline-content">${item.activity}</div>
                </div>`
            ).join('');

            let highlightsHTML = details.highlights ?
                `<div class="info-panel-section">
                    <div class="info-panel-section-title">âœ¨ è¡Œç¨‹äº®ç‚¹</div>
                    <ul class="info-panel-list">
                        ${details.highlights.map(h => `<li>${h}</li>`).join('')}
                    </ul>
                </div>` : '';

            let tipsHTML = details.tips ?
                `<div class="info-panel-section">
                    <div class="info-panel-section-title">ğŸ’¡ æ³¨æ„äº‹é¡¹</div>
                    <ul class="info-panel-list">
                        ${details.tips.map(t => `<li>${t}</li>`).join('')}
                    </ul>
                </div>` : '';

            let extraInfo = '';
            if (details.distance) extraInfo += `<p><strong>ğŸ“ é‡Œç¨‹ï¼š</strong>${details.distance}</p>`;
            if (details.accommodation) extraInfo += `<p><strong>ğŸ¨ ä½å®¿ï¼š</strong>${details.accommodation}</p>`;
            if (details.meals) extraInfo += `<p><strong>ğŸ½ï¸ é¤é£Ÿï¼š</strong>${details.meals}</p>`;
            if (details.intensity) extraInfo += `<p><strong>ğŸ’ª å¼ºåº¦ï¼š</strong>${details.intensity}</p>`;
            if (details.tour) extraInfo += `<p><strong>ğŸ‘¥ æ—…è¡Œå›¢ï¼š</strong>${details.tour}</p>`;
            if (details.price) extraInfo += `<p><strong>ğŸ’° ä»·æ ¼ï¼š</strong>${details.price}</p>`;

            document.getElementById('infoPanelContent').innerHTML = `
                <div class="info-panel-header">${details.title}</div>
                <div class="info-panel-content">
                    ${weatherHTML}
                    <div class="info-panel-section">
                        <div class="info-panel-section-title">ğŸ“… ${details.date}</div>
                        <p>${details.description}</p>
                        ${extraInfo}
                    </div>
                    <div class="info-panel-section">
                        <div class="info-panel-section-title">â° æ—¶é—´å®‰æ’</div>
                        ${scheduleHTML}
                    </div>
                    ${highlightsHTML}
                    ${tipsHTML}
                </div>
            `;
        }

        function closeInfoPanel() {
            document.getElementById('infoPanel').classList.remove('active');
        }

        // ==================== æ€»è§ˆäº¤äº’ ====================
        function getDayLocations(dayNum) {
            const locs = [];
            Object.entries(locationDayMap).forEach(([key, info]) => {
                if (info.days.includes(dayNum)) {
                    locs.push(info.name);
                }
            });
            return locs;
        }

        function showOverviewLocationPanel(locationKey, info) {
            let html = `<div class="overview-location-header">ğŸ“ ${info.name}</div><div class="info-panel-content">`;

            if (info.days.length === 1) {
                const dayNum = info.days[0];
                const detail = dayDetails[dayNum];
                const dayLocs = getDayLocations(dayNum);
                html += `
                    <div style="margin-bottom:10px;">
                        <span class="overview-day-badge">Day ${dayNum}</span>
                        <strong>${detail.title.replace(/Day \d+: /, '')}</strong>
                    </div>
                    <p style="margin-bottom:10px;color:#666;">${detail.description}</p>
                    <div class="info-panel-section">
                        <div class="info-panel-section-title">ğŸ“Œ å½“å¤©å…¨éƒ¨æ™¯ç‚¹</div>
                        <ul class="info-panel-list">
                            ${dayLocs.map(name => `<li${name === info.name ? ' style="color:#667eea;font-weight:bold;"' : ''}>${name}</li>`).join('')}
                        </ul>
                    </div>
                    <button class="view-day-btn" onclick="showDay(${dayNum})">æŸ¥çœ‹ Day ${dayNum} è¯¦ç»†è¡Œç¨‹ â†’</button>
                `;
            } else {
                html += `<p style="margin-bottom:12px;color:#666;">è¯¥åœ°ç‚¹å‡ºç°åœ¨ä»¥ä¸‹æ—¥æœŸçš„è¡Œç¨‹ä¸­ï¼š</p>`;
                info.days.forEach(dayNum => {
                    const detail = dayDetails[dayNum];
                    const dayLocs = getDayLocations(dayNum);
                    html += `
                        <div class="overview-day-card" onclick="showDay(${dayNum})">
                            <div class="overview-day-card-title">
                                <span class="overview-day-badge">Day ${dayNum}</span>
                                ${detail.title.replace(/Day \d+: /, '')}
                            </div>
                            <div class="overview-day-card-spots">${dayLocs.join(' Â· ')}</div>
                        </div>
                    `;
                });
            }

            html += '</div>';
            document.getElementById('infoPanelContent').innerHTML = html;
            document.getElementById('infoPanel').classList.add('active');
        }

        // ==================== æ¯æ—¥è¡Œç¨‹ ====================
        const itineraries = {
            0: { // æ€»è§ˆ
                routes: [
                    {coords: [locations.reykjavik, locations.thingvellir, locations.bruarfoss, locations.geysir, locations.gullfoss, locations.seljalandsfoss, locations.hotel_dranghlid], color: '#FF6B6B', weight: 4},
                    {coords: [locations.hotel_dranghlid, locations.skogafoss, locations.falljokull, locations.hrifunes, locations.jokulsarlon, locations.diamond_beach, locations.reynisfjara, locations.reykjavik], color: '#4ECDC4', weight: 4},
                    {coords: [locations.reykjavik, locations.ytri_tunga, locations.budir, locations.arnarstapi, locations.djupalonssandur, locations.londrangar, locations.kirkjufell, locations.reykjavik], color: '#45B7AF', weight: 4},
                    {coords: [locations.reykjavik, locations.fagradalsfjall, locations.blue_lagoon, locations.reykjavik], color: '#F38181', weight: 4}
                ],
                markers: [],
                onShow: () => closeInfoPanel()
            },
            1: {
                routes: [
                    {coords: [locations.keflavik_airport, locations.reykjavik], color: '#667eea', weight: 4, dash: '10, 10'}
                ],
                markers: [
                    {pos: locations.keflavik_airport, icon: attractionIcon, popup: '<div class="popup-header">âœˆï¸ å‡¯å¤«æ‹‰ç»´å…‹æœºåœº</div><div class="popup-body"><p><strong>â° åˆ°è¾¾ï¼š</strong>23:55</p><p><strong>ğŸšŒ å‰å¾€å¸‚åŒºï¼š</strong>Flybus 45åˆ†é’Ÿ æˆ– å‡ºç§Ÿè½¦35åˆ†é’Ÿ</p><p><strong>ğŸ’° äº¤é€šï¼š</strong>Â¥270ï¼ˆFlybusï¼‰æˆ– Â¥990ï¼ˆå‡ºç§Ÿè½¦ï¼Œæ¨èï¼‰</p><div class="popup-highlight">ğŸ’¡ æ·±å¤œå»ºè®®æ‰“å‡ºç§Ÿè½¦ï¼Œæ›´å®‰å…¨å¿«æ·</div></div>'},
                    {pos: locations.reykjavik, icon: hotelIcon, popup: '<div class="popup-header">ğŸ¨ é›·å…‹é›…æœªå…‹</div><div class="popup-body"><p><strong>â° å…¥ä½ï¼š</strong>çº¦02:00</p><p><strong>ğŸ’¤ ä¼‘æ¯ï¼š</strong>æ—©ç‚¹ç¡è§‰</p><div class="popup-highlight">âš ï¸ æå‰å‘ŠçŸ¥é…’åº—æ·±å¤œå…¥ä½æ—¶é—´</div></div>'}
                ],
                onShow: () => showInfoPanel(1)
            },
            2: {
                routes: [],
                markers: [
                    {pos: locations.reykjavik, icon: hotelIcon, popup: '<div class="popup-header">ğŸ™ï¸ é›·å…‹é›…æœªå…‹å¸‚åŒºè§‚å…‰</div><div class="popup-body"><p><strong>â›ª å“ˆå°”æ ¼æ—å§†æ•™å ‚</strong><br/>ç™»å¡”Â¥55ï¼Œä¿¯ç°å…¨åŸ</p><p><strong>ğŸ›ï¸ Laugavegurè´­ç‰©è¡—</strong><br/>å’–å•¡é¦†ã€çºªå¿µå“</p><p><strong>ğŸŒŠ è€æ¸¯å£</strong><br/>HarpaéŸ³ä¹å…</p><p><strong>ğŸ›’ Bonusè¶…å¸‚</strong><br/>é‡‡è´­3å¤©é›¶é£Ÿæ°´</p><div class="popup-highlight">ğŸ’¡ ä»Šæ™šæ—©ç¡ï¼Œæ˜å¤©8:00å‡ºå‘3æ—¥å›¢</div></div>'}
                ],
                onShow: () => showInfoPanel(2)
            },
            3: {
                routes: [
                    {coords: [locations.reykjavik, locations.thingvellir, locations.bruarfoss, locations.geysir, locations.gullfoss, locations.seljalandsfoss, locations.hotel_dranghlid], color: '#FF6B6B', weight: 4}
                ],
                markers: [
                    {pos: locations.thingvellir, icon: attractionIcon, popup: '<div class="popup-header">ğŸŒ è¾›æ ¼éŸ¦å¾·åˆ©å›½å®¶å…¬å›­</div><div class="popup-body"><p><strong>äº®ç‚¹ï¼š</strong>ä¸–ç•Œé—äº§ï¼Œä¸¤å¤§æ¿å—äº¤ç•Œ</p><p><strong>æ—¶é—´ï¼š</strong>09:30-10:30ï¼ˆ1å°æ—¶ï¼‰</p><p><strong>æ´»åŠ¨ï¼š</strong>æ­¥é“å¾’æ­¥ï¼Œè§‚çœ‹æ¿å—è£‚ç¼</p></div>'},
                    {pos: locations.bruarfoss, icon: attractionIcon, popup: '<div class="popup-header">ğŸ’™ å¸ƒé²é˜¿å°”ç€‘å¸ƒ</div><div class="popup-body"><p><strong>äº®ç‚¹ï¼š</strong>å†°å²›æœ€è“çš„ç€‘å¸ƒ</p><p><strong>æ—¶é—´ï¼š</strong>11:00-11:30ï¼ˆ30åˆ†é’Ÿï¼‰</p><p><strong>ç‰¹è‰²ï¼š</strong>å®çŸ³è“è‰²æ°´æµ</p></div>'},
                    {pos: locations.geysir, icon: attractionIcon, popup: '<div class="popup-header">ğŸ’¨ é—´æ­‡æ³‰åŒº</div><div class="popup-body"><p><strong>äº®ç‚¹ï¼š</strong>Strokkuré—´æ­‡æ³‰</p><p><strong>æ—¶é—´ï¼š</strong>12:00-12:45ï¼ˆ45åˆ†é’Ÿï¼‰</p><p><strong>å–·å‘ï¼š</strong>æ¯5-10åˆ†é’Ÿï¼Œé«˜è¾¾35ç±³</p><div class="popup-highlight">ğŸ“¸ æ‹ç…§æ—¶æ³¨æ„å®‰å…¨è·ç¦»</div></div>'},
                    {pos: locations.gullfoss, icon: starIcon, popup: '<div class="popup-header">â­ é»„é‡‘ç€‘å¸ƒ</div><div class="popup-body"><p><strong>äº®ç‚¹ï¼š</strong>åŒå±‚ç€‘å¸ƒï¼Œéœ‡æ’¼å£®è§‚</p><p><strong>æ—¶é—´ï¼š</strong>13:00-14:00ï¼ˆ1å°æ—¶ï¼‰</p><p><strong>ç‰¹è‰²ï¼š</strong>é˜³å…‰ä¸‹å¯è§å½©è™¹</p><p><strong>è½å·®ï¼š</strong>11ç±³+21ç±³</p></div>'},
                    {pos: locations.seljalandsfoss, icon: starIcon, popup: '<div class="popup-header">â­ å¡é‡Œé›…å…°ç€‘å¸ƒ</div><div class="popup-body"><p><strong>äº®ç‚¹ï¼š</strong>å¯èµ°åˆ°ç€‘å¸ƒåé¢</p><p><strong>æ—¶é—´ï¼š</strong>15:30-16:30ï¼ˆ1å°æ—¶ï¼‰</p><p><strong>ç‰¹è‰²ï¼š</strong>ç‹¬ç‰¹æ‹æ‘„è§’åº¦</p><div class="popup-highlight">âš ï¸ å¿…å¤‡é˜²æ°´é›¨è¡£ï¼Œä¼šå…¨èº«æ¹¿é€</div></div>'},
                    {pos: locations.hotel_dranghlid, icon: hotelIcon, popup: '<div class="popup-header">ğŸ¨ å—æµ·å²¸é…’åº—</div><div class="popup-body"><p><strong>é…’åº—ï¼š</strong>Hotel DrangshlÃ­Ã°</p><p><strong>ä½ç½®ï¼š</strong>å—æµ·å²¸ä¹¡æ‘</p><p><strong>æ™šé¤ï¼š</strong>éƒ¨åˆ†åŒ…å«æˆ–è‡ªè´¹</p><p><strong>æ™šä¸Šï¼š</strong>ğŸŒŒ è¿½æå…‰ï¼ˆç¬¬ä¸€æ™šï¼‰</p><div class="popup-highlight">ğŸ’¡ è¿œç¦»å…‰æ±¡æŸ“ï¼Œæå…‰è§‚æµ‹ç»ä½³åœ°</div></div>'}
                ],
                onShow: () => showInfoPanel(3)
            },
            4: {
                routes: [
                    {coords: [locations.hotel_dranghlid, locations.skogafoss, locations.falljokull, locations.hrifunes], color: '#4ECDC4', weight: 4}
                ],
                markers: [
                    {pos: locations.skogafoss, icon: attractionIcon, popup: '<div class="popup-header">ğŸ’¦ æ–¯ç§‘åŠ ç€‘å¸ƒ</div><div class="popup-body"><p><strong>é«˜åº¦ï¼š</strong>60ç±³</p><p><strong>æ—¶é—´ï¼š</strong>08:30-09:30ï¼ˆ1å°æ—¶ï¼‰</p><p><strong>ç‰¹è‰²ï¼š</strong>å¯çˆ¬430çº§å°é˜¶åˆ°é¡¶</p><p><strong>æ‹æ‘„ï¼š</strong>å¸¸è§å½©è™¹</p></div>'},
                    {pos: locations.falljokull, icon: starIcon, popup: '<div class="popup-header">â­ğŸ§Š å†°å·å¾’æ­¥ï¼ˆæ ¸å¿ƒæ´»åŠ¨ï¼‰</div><div class="popup-body"><p><strong>å†°å·ï¼š</strong>FalljÃ¶kull</p><p><strong>æ—¶é•¿ï¼š</strong>2-3å°æ—¶</p><p><strong>è£…å¤‡ï¼š</strong>å†°çˆªã€å¤´ç›”ã€å†°é•ï¼ˆæä¾›ï¼‰</p><p><strong>æ´»åŠ¨ï¼š</strong>å†°å·è¡Œèµ°ã€æ¢ç´¢å†°ç¼</p><div class="popup-highlight">âš ï¸ å¿…é¡»ç©¿é˜²æ°´å¾’æ­¥é‹ï¼ˆè„šè¸æ”¯æ’‘ï¼‰<br/>â„ï¸ ä½“éªŒè“å†°ä¸–ç•Œï¼Œä¸“ä¸šå¯¼æ¸¸è®²è§£</div></div>'},
                    {pos: locations.hrifunes, icon: hotelIcon, popup: '<div class="popup-header">ğŸ¨ å—æµ·å²¸ä¸œéƒ¨é…’åº—</div><div class="popup-body"><p><strong>é…’åº—ï¼š</strong>HrÃ­funes Inn</p><p><strong>ä½ç½®ï¼š</strong>å—æµ·å²¸ä¸œéƒ¨</p><p><strong>æ™šä¸Šï¼š</strong>ğŸŒŒ è¿½æå…‰ï¼ˆç¬¬äºŒæ™šï¼‰</p><div class="popup-highlight">ğŸ’¡ ä»Šå¤©å†°å·å¾’æ­¥å¾ˆç´¯ï¼Œæ—©ç‚¹ä¼‘æ¯</div></div>'}
                ],
                onShow: () => showInfoPanel(4)
            },
            5: {
                routes: [
                    {coords: [locations.hrifunes, locations.jokulsarlon, locations.diamond_beach, locations.reynisfjara, locations.reykjavik], color: '#4ECDC4', weight: 4}
                ],
                markers: [
                    {pos: locations.jokulsarlon, icon: starIcon, popup: '<div class="popup-header">â­ğŸ§Š æ°å¤æ²™é¾™å†°æ²³æ¹–</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>æ¬§æ´²æœ€å¤§å†°æ²³æ¹–</p><p><strong>æ—¶é—´ï¼š</strong>09:00-10:00ï¼ˆ1å°æ—¶ï¼‰</p><p><strong>æ™¯è§‚ï¼š</strong>å·¨å¤§å†°å±±æ¼‚æµ®</p><p><strong>é‡ç”ŸåŠ¨ç‰©ï¼š</strong>å¯èƒ½çœ‹åˆ°æµ·è±¹</p><div class="popup-highlight">ğŸ“¸ æ‘„å½±å¤©å ‚ï¼Œç»ç¾æ™¯è‰²</div></div>'},
                    {pos: locations.diamond_beach, icon: attractionIcon, popup: '<div class="popup-header">ğŸ’ é’»çŸ³æµ·æ»©</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>å†°å—å¦‚é’»çŸ³</p><p><strong>æ—¶é—´ï¼š</strong>10:15-10:45ï¼ˆ30åˆ†é’Ÿï¼‰</p><p><strong>æ™¯è§‚ï¼š</strong>å†°å—æ•£è½é»‘æ²™æ»©</p><p><strong>æ‹æ‘„ï¼š</strong>é˜³å…‰ä¸‹é—ªé—ªå‘å…‰</p></div>'},
                    {pos: locations.ice_cave, icon: starIcon, popup: '<div class="popup-header">â­â„ï¸ è“å†°æ´ï¼ˆæ ¸å¿ƒæ´»åŠ¨ï¼‰</div><div class="popup-body"><p><strong>å†°å·ï¼š</strong>VatnajÃ¶kullå†…éƒ¨</p><p><strong>æ—¶é•¿ï¼š</strong>2-3å°æ—¶</p><p><strong>äº¤é€šï¼š</strong>Super Jeepå‰å¾€</p><p><strong>è£…å¤‡ï¼š</strong>å¤´ç›”ã€å†°çˆªï¼ˆæä¾›ï¼‰</p><p><strong>æ™¯è§‚ï¼š</strong>éœ‡æ’¼è“è‰²å†°å¢™</p><div class="popup-highlight">â„ï¸ å†¬å­£é™å®šï¼ˆ10-3æœˆï¼‰<br/>ğŸ’™ è¿›å…¥å†°å·å†…éƒ¨ï¼Œæ°´æ™¶èˆ¬çš„è“å†°</div></div>'},
                    {pos: locations.reynisfjara, icon: attractionIcon, popup: '<div class="popup-header">ğŸ–¤ é›·å°¼æ–¯é»‘æ²™æ»©</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>é»‘è‰²ç«å±±æ²™</p><p><strong>æ—¶é—´ï¼š</strong>15:30-16:30ï¼ˆ1å°æ—¶ï¼‰</p><p><strong>æ™¯è§‚ï¼š</strong>å…­è§’ç„æ­¦å²©æŸ±ã€æµ·ä¸­å²©æŸ±</p><div class="popup-highlight">âš ï¸ å±é™©ï¼Sneaker wavesï¼ˆå·è¢­æµªï¼‰<br/>âŒ ç»å¯¹ä¸èƒ½èƒŒå¯¹å¤§æµ·</div></div>'},
                    {pos: locations.reykjavik, icon: hotelIcon, popup: '<div class="popup-header">ğŸ¨ è¿”å›é›·å…‹é›…æœªå…‹</div><div class="popup-body"><p><strong>åˆ°è¾¾æ—¶é—´ï¼š</strong>çº¦20:00</p><p><strong>ä½å®¿ï¼š</strong>å¸‚åŒºé…’åº—</p><p><strong>æ™šé¤ï¼š</strong>è‡ªç†</p><div class="popup-highlight">ğŸ’¡ ä»Šå¤©è¡Œç¨‹æœ€é•¿ï¼Œæ™šé¤å»ºè®®å¤–å–æˆ–è¶…å¸‚</div></div>'}
                ],
                onShow: () => showInfoPanel(5)
            },
            6: {
                routes: [
                    {coords: [locations.reykjavik, locations.ytri_tunga, locations.budir, locations.arnarstapi, locations.djupalonssandur, locations.londrangar, locations.kirkjufell, locations.reykjavik], color: '#45B7AF', weight: 4}
                ],
                markers: [
                    {pos: locations.ytri_tunga, icon: attractionIcon, popup: '<div class="popup-header">ğŸ¦­ Ytri-Tungaæµ·æ»©</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>é‡ç”Ÿæµ·è±¹æ –æ¯åœ°</p><p><strong>æ—¶é—´ï¼š</strong>11:00-11:45ï¼ˆ45åˆ†é’Ÿï¼‰</p><p><strong>è§‚å¯Ÿï¼š</strong>è¿œè·ç¦»è§‚çœ‹æµ·è±¹</p><div class="popup-highlight">âš ï¸ ä¸è¦é è¿‘æ‰“æ‰°æµ·è±¹</div></div>'},
                    {pos: locations.budir, icon: attractionIcon, popup: '<div class="popup-header">â›ª BÃºÃ°iré»‘æ•™å ‚</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>æ ‡å¿—æ€§é»‘è‰²æœ¨æ•™å ‚</p><p><strong>æ—¶é—´ï¼š</strong>12:15-12:45ï¼ˆ30åˆ†é’Ÿï¼‰</p><p><strong>èƒŒæ™¯ï¼š</strong>ç†”å²©åœ°å’Œé›ªå±±</p><p><strong>æ‹æ‘„ï¼š</strong>ç½‘çº¢æ‰“å¡ç‚¹</p></div>'},
                    {pos: locations.arnarstapi, icon: attractionIcon, popup: '<div class="popup-header">ğŸŒŠ Arnarstapiæ¸”æ‘</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>å¤©ç„¶çŸ³æ‹±é—¨</p><p><strong>æ—¶é—´ï¼š</strong>13:00-14:00ï¼ˆ1å°æ—¶ï¼‰</p><p><strong>æ´»åŠ¨ï¼š</strong>æµ·å²¸æ­¥é“å¾’æ­¥</p><p><strong>æ™¯è§‚ï¼š</strong>å£®è§‚æ‚¬å´–ï¼Œæµ·æµªæ‹å²¸</p></div>'},
                    {pos: locations.djupalonssandur, icon: attractionIcon, popup: '<div class="popup-header">ğŸ–¤ DjÃºpalÃ³nssandur</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>é»‘è‰²åµçŸ³æµ·æ»©</p><p><strong>æ—¶é—´ï¼š</strong>15:15-16:00ï¼ˆ45åˆ†é’Ÿï¼‰</p><p><strong>å†å²ï¼š</strong>1948å¹´æ²‰èˆ¹é—è¿¹</p><p><strong>æ–‡åŒ–ï¼š</strong>å¤ä»£ä¸¾é‡çŸ³ï¼ˆæµ‹è¯•æ¸”æ°‘åŠ›é‡ï¼‰</p></div>'},
                    {pos: locations.londrangar, icon: attractionIcon, popup: '<div class="popup-header">ğŸ—¿ LÃ³ndrangarç„æ­¦å²©æŸ±</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>75ç±³é«˜ç„æ­¦å²©å¡</p><p><strong>æ—¶é—´ï¼š</strong>16:15-16:45ï¼ˆ30åˆ†é’Ÿï¼‰</p><p><strong>åœ°è´¨ï¼š</strong>å¤ç«å±±å£é—è¿¹</p><p><strong>é‡ç”ŸåŠ¨ç‰©ï¼š</strong>æµ·é¸Ÿæ –æ¯åœ°</p></div>'},
                    {pos: locations.kirkjufell, icon: starIcon, popup: '<div class="popup-header">â­ğŸ”ï¸ æ•™ä¼šå±±ï¼ˆæœ€ä¸Šé•œåœ°æ ‡ï¼‰</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>å†°å²›åœ°æ ‡ï¼Œæœ€ä¸Šé•œ</p><p><strong>æ—¶é—´ï¼š</strong>17:30-18:30ï¼ˆ1å°æ—¶ï¼‰</p><p><strong>è‘—åï¼š</strong>ã€ŠæƒåŠ›çš„æ¸¸æˆã€‹å–æ™¯åœ°</p><p><strong>æ„å›¾ï¼š</strong>ç€‘å¸ƒ+æ•™ä¼šå±±ç»å…¸ç»„åˆ</p><div class="popup-highlight">ğŸ“¸ æœ€ä½³æ‹æ‘„ï¼šä¸‹åˆ3-4ç‚¹ï¼ˆæ—¥è½å‰ï¼‰<br/>ğŸ’¡ å¤šç•™æ—¶é—´æ‹ç…§</div></div>'},
                    {pos: locations.reykjavik, icon: hotelIcon, popup: '<div class="popup-header">ğŸ¨ è¿”å›é›·å…‹é›…æœªå…‹</div><div class="popup-body"><p><strong>åˆ°è¾¾ï¼š</strong>çº¦20:00</p><p><strong>å¯¼æ¸¸ï¼š</strong>ğŸ—£ï¸ ä¸­æ–‡å…¨ç¨‹è®²è§£</p><p><strong>æ—¶é•¿ï¼š</strong>12å°æ—¶</p><div class="popup-highlight">ğŸ’¡ æ²Ÿé€šæ— éšœç¢ï¼Œä½“éªŒæ›´ä½³</div></div>'}
                ],
                onShow: () => showInfoPanel(6)
            },
            7: {
                routes: [
                    {coords: [locations.reykjavik, locations.fagradalsfjall, locations.blue_lagoon, locations.reykjavik], color: '#F38181', weight: 4}
                ],
                markers: [
                    {pos: locations.fagradalsfjall, icon: starIcon, popup: '<div class="popup-header">â­ğŸŒ‹ æ´»ç«å±±å¾’æ­¥ï¼ˆæ ¸å¿ƒæ´»åŠ¨ï¼‰</div><div class="popup-body"><p><strong>ç«å±±ï¼š</strong>FagradalsfjallåŒºåŸŸ</p><p><strong>æ—¶é•¿ï¼š</strong>å¾€è¿”æœ€å¤š4å°æ—¶</p><p><strong>åœ°å½¢ï¼š</strong>å´å²–ç†”å²©åœ°ï¼Œæœ‰å¡åº¦</p><p><strong>éš¾åº¦ï¼š</strong>ä¸­ç­‰ï¼ˆéœ€åˆç†ä½“èƒ½ï¼‰</p><p><strong>æ™¯è§‚ï¼š</strong>2021-2023å–·å‘é—å€</p><div class="popup-highlight">â—â—â—ä¸¥æ ¼è£…å¤‡è¦æ±‚ï¼š<br/>âœ“ é˜²æ°´è£¤ï¼ˆâŒç¦ç©¿ç‰›ä»”è£¤ï¼ï¼‰<br/>âœ“ é˜²æ°´å¾’æ­¥é‹<br/>âœ“ ç™»å±±æ–<br/>âœ“ æ°´1L+é›¶é£Ÿ</div></div>'},
                    {pos: locations.blue_lagoon, icon: starIcon, popup: '<div class="popup-header">â­â™¨ï¸ è“æ¹–æ¸©æ³‰ï¼ˆæ ¸å¿ƒæ´»åŠ¨ï¼‰</div><div class="popup-body"><p><strong>ç‰¹è‰²ï¼š</strong>åœ°çƒ­çŸ¿ç‰©è´¨æ¸©æ³‰</p><p><strong>æ—¶é•¿ï¼š</strong>2.5å°æ—¶</p><p><strong>å¥—é¤ï¼š</strong>Comfortï¼ˆåŒ…å«ï¼‰</p><p><strong>åŒ…å«ï¼š</strong>æ¯›å·¾ã€ç¡…æ³¥é¢è†œã€é¦–æ¯é¥®å“</p><p><strong>æ°´æ¸©ï¼š</strong>37-40Â°C</p><div class="popup-highlight">â™¨ï¸ å®Œç¾æ”¾æ¾èˆ’ç¼“å¾’æ­¥ç–²åŠ³<br/>ğŸ’™ ä¹³è“è‰²æ³‰æ°´ï¼Œå¯¹çš®è‚¤å¥½<br/>âœ“ éœ€è‡ªå¤‡æ³³è¡£</div></div>'},
                    {pos: locations.reykjavik, icon: hotelIcon, popup: '<div class="popup-header">ğŸ¨ è¿”å›é›·å…‹é›…æœªå…‹</div><div class="popup-body"><p><strong>åˆ°è¾¾ï¼š</strong>çº¦18:00</p><p><strong>ä»Šæ™šä»»åŠ¡ï¼š</strong>â—æ‰“åŒ…è¡Œæ</p><p><strong>æ˜å¤©ï¼š</strong>16:20ç¦»å¢ƒ</p><div class="popup-highlight">âš ï¸ å¿…é¡»ä»Šæ™šæ‰“åŒ…å¥½æ‰€æœ‰è¡Œæï¼<br/>ğŸ’¡ æ£€æŸ¥æŠ¤ç…§ã€æœºç¥¨ã€è´µé‡ç‰©å“</div></div>'}
                ],
                onShow: () => showInfoPanel(7)
            },
            8: {
                routes: [
                    {coords: [locations.reykjavik, locations.keflavik_airport], color: '#667eea', weight: 4, dash: '10, 10'}
                ],
                markers: [
                    {pos: locations.reykjavik, icon: hotelIcon, popup: '<div class="popup-header">ğŸ¨ é›·å…‹é›…æœªå…‹</div><div class="popup-body"><p><strong>ä¸Šåˆï¼š</strong>ğŸ›ï¸ 3å°æ—¶è‡ªç”±è´­ç‰©</p><p><strong>12:30ï¼š</strong>è¿”å›é…’åº—</p><p><strong>13:00ï¼š</strong>å‡ºå‘æœºåœº</p><div class="popup-highlight">ğŸ’¡ æœ€åè´­ç‰©æœºä¼š<br/>âš ï¸ é€€æˆ¿å‰æ£€æŸ¥æ‰€æœ‰ç‰©å“</div></div>'},
                    {pos: locations.keflavik_airport, icon: attractionIcon, popup: '<div class="popup-header">âœˆï¸ å‡¯å¤«æ‹‰ç»´å…‹æœºåœº</div><div class="popup-body"><p><strong>åˆ°è¾¾ï¼š</strong>13:45</p><p><strong>èµ·é£ï¼š</strong>16:20ï¼ˆFI454ï¼‰</p><p><strong>æŠµè¾¾ä¼¦æ•¦ï¼š</strong>19:30</p><p><strong>å…ç¨åº—ï¼š</strong>å·§å…‹åŠ›ã€é…’æ›´ä¾¿å®œ</p><div class="popup-highlight">ğŸ’° é€€ç¨ï¼šè´­ç‰©è¶…ISK 6,000å¯é€€ç¨<br/>â° æå‰2.5å°æ—¶åˆ°æœºåœº</div></div>'}
                ],
                onShow: () => showInfoPanel(8)
            }
        };

        // ==================== æ ¸å¿ƒæ˜¾ç¤ºé€»è¾‘ ====================
        function showDay(day) {
            currentLayers.clearLayers();
            currentDay = day;

            const itinerary = itineraries[day];
            const baseWeight = day === 0 ? 4 : 5;

            // ç»˜åˆ¶è·¯çº¿ï¼ˆå¸¦å‘å…‰æ•ˆæœï¼Œå«æ˜Ÿåº•å›¾ä¸Šæ›´ç²—æ›´äº®ï¼‰
            itinerary.routes.forEach((route, idx) => {
                const w = route.weight || baseWeight;
                // å¤–å‘å…‰å±‚
                const glow = L.polyline(route.coords, {
                    color: route.color,
                    weight: w + 10,
                    opacity: 0.2,
                    dashArray: route.dash || null,
                    lineCap: 'round',
                    lineJoin: 'round'
                });
                currentLayers.addLayer(glow);

                // ç™½è‰²æè¾¹å±‚ï¼ˆå¢åŠ å¯¹æ¯”åº¦ï¼‰
                const outline = L.polyline(route.coords, {
                    color: '#ffffff',
                    weight: w + 3,
                    opacity: 0.4,
                    dashArray: route.dash || null,
                    lineCap: 'round',
                    lineJoin: 'round'
                });
                currentLayers.addLayer(outline);

                // ä¸»çº¿
                const polyline = L.polyline(route.coords, {
                    color: route.color,
                    weight: w,
                    opacity: 0.95,
                    dashArray: route.dash || null,
                    lineCap: 'round',
                    lineJoin: 'round'
                });
                currentLayers.addLayer(polyline);

                // æ€»è§ˆæ¨¡å¼ï¼šè·¯çº¿å¯ç‚¹å‡»+tooltip
                if (day === 0 && routeDayMap[idx]) {
                    const info = routeDayMap[idx];
                    polyline.bindTooltip(info.label, { sticky: true });
                    polyline.on('click', () => showDay(info.day));
                    polyline.on('mouseover', function() {
                        this.setStyle({ weight: w + 3, opacity: 1 });
                        glow.setStyle({ weight: w + 16, opacity: 0.35 });
                    });
                    polyline.on('mouseout', function() {
                        this.setStyle({ weight: w, opacity: 0.95 });
                        glow.setStyle({ weight: w + 10, opacity: 0.2 });
                    });
                }
            });

            // æ€»è§ˆæ¨¡å¼ï¼šæ·»åŠ ç¼–å·+é¢œè‰²åˆ†ç»„æ ‡è®°
            if (day === 0) {
                const showLabels = map.getZoom() >= 9;
                Object.entries(locationDayMap).forEach(([key, info]) => {
                    const primaryDay = info.days[0];
                    const icon = createNumberedIcon(primaryDay, info.name, info.type, showLabels);
                    const marker = L.marker(locations[key], { icon: icon });
                    marker.on('click', () => showOverviewLocationPanel(key, info));
                    marker.bindTooltip(info.name, { direction: 'top', offset: [0, -16] });
                    currentLayers.addLayer(marker);
                });
            } else {
                // æ¯æ—¥è§†å›¾ï¼šç¼–å·æ ‡è®° + popup
                itinerary.markers.forEach((marker, idx) => {
                    let type = 'attraction';
                    if (marker.icon === hotelIcon) type = 'hotel';
                    else if (marker.icon === starIcon) type = 'star';
                    const icon = createDayIcon(day, type);
                    const m = L.marker(marker.pos, { icon: icon })
                        .bindPopup(marker.popup, {maxWidth: 300});
                    currentLayers.addLayer(m);
                });
            }

            // å¹³æ»‘è¿‡æ¸¡åˆ°è§†å›¾èŒƒå›´
            const padding = day === 0 ? [30, 30] : [50, 50];
            if (itinerary.routes.length > 0) {
                const allCoords = itinerary.routes.flatMap(r => r.coords);
                if (day === 0) {
                    Object.keys(locationDayMap).forEach(key => {
                        allCoords.push(locations[key]);
                    });
                }
                if (allCoords.length > 0) {
                    map.flyToBounds(L.latLngBounds(allCoords), {padding: padding, duration: 1.2, maxZoom: day === 0 ? 8 : 11});
                }
            } else if (itinerary.markers.length > 0) {
                const markerCoords = itinerary.markers.map(m => m.pos);
                map.flyToBounds(L.latLngBounds(markerCoords), {padding: padding, duration: 1.2, maxZoom: 11});
            }

            // æ›´æ–°ä¾§è¾¹æ 
            document.querySelectorAll('.day-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelector(`[data-day="${day}"]`).classList.add('active');

            // æ˜¾ç¤ºä¿¡æ¯é¢æ¿
            if (itinerary.onShow) {
                itinerary.onShow();
            }
        }

        // ç¼©æ”¾æ—¶æ›´æ–°æ€»è§ˆæ ‡ç­¾æ˜¾ç¤º
        map.on('zoomend', function() {
            if (currentDay === 0) {
                const showLabels = map.getZoom() >= 9;
                currentLayers.eachLayer(layer => {
                    if (layer instanceof L.Marker) {
                        const latlng = layer.getLatLng();
                        const key = Object.keys(locations).find(k =>
                            locations[k][0] === latlng.lat && locations[k][1] === latlng.lng
                        );
                        if (key && locationDayMap[key]) {
                            const info = locationDayMap[key];
                            const primaryDay = info.days[0];
                            layer.setIcon(createNumberedIcon(primaryDay, info.name, info.type, showLabels));
                        }
                    }
                });
            }
        });

        // ä¾§è¾¹æ ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.day-section').forEach(section => {
            section.addEventListener('click', function() {
                const day = parseInt(this.getAttribute('data-day'));
                showDay(day);
            });
        });

        // é»˜è®¤æ˜¾ç¤ºDay 3ï¼ˆé»„é‡‘åœˆï¼‰
        showDay(3);

        // é¡µé¢åŠ è½½åè·å–å¤©æ°”
        updateSidebarWeather();
    </script>
</body>
</html>
